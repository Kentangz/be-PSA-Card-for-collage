import{r as l,g as z,u as Y,d as q,a as $,j as e,b as D,c as M,I as H,v as J}from"./index-BC6JLvdP.js";const K=t=>{const[r,o]=l.useState([]),[m,a]=l.useState(!1),[b,y]=l.useState(null),C=l.useRef([]),g=l.useCallback(async()=>{if(t)try{const i=await z(t);o(i)}catch{o([])}},[t]);l.useEffect(()=>{C.current=r},[r]);const v=l.useCallback(async i=>{if(!t||i.length===0)return[];a(!0);try{const u=await Promise.all(i.map(S=>Y(t,S))),p=[...r,...u];return o(p),await g(),u}finally{a(!1)}},[t,r,g]),c=l.useCallback(async i=>{if(t){y(i);try{await q(t,i);const u=r.filter(p=>p.id!==i);o(u),await g()}finally{y(null)}}},[t,r,g]);return{deliveryProofs:r,fetchProofs:g,uploadFiles:v,deleteProof:c,uploading:m,deletingId:b}},O=t=>({handleUpdateSubmission:l.useCallback(async o=>{t&&await $(t,o)},[t])}),Q=({previews:t,uploading:r,uploadProgress:o,onRemove:m})=>t.length===0?null:e.jsxs("div",{className:"mt-3 space-y-3 border-2 border-green-500 p-4 rounded-lg bg-green-50",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h5",{className:"text-sm font-medium text-green-900",children:["Selected Images (",t.length,")"]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:t.map(a=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a.preview,alt:`Preview ${a.file.name}`,className:"w-full h-16 sm:h-20 object-cover rounded-lg border border-gray-300 shadow-sm"}),r&&o[a.id]!==void 0&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"text-white text-xs",children:[o[a.id],"%"]})}),e.jsx("button",{onClick:()=>m(a.id),disabled:r,className:"absolute -top-1 -right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold transition-colors opacity-0 group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Remove image",children:"×"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg truncate",children:a.file.name})]},a.id))})]}),V=({proofs:t,deletingId:r,onDelete:o,onPreview:m})=>t.length===0?null:e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:["Uploaded Proofs (",t.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:t.map(a=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:D(a.image_path),alt:`Delivery proof ${a.id}`,className:"w-full h-20 sm:h-24 object-cover rounded-lg border cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>m(D(a.image_path))}),e.jsx("button",{onClick:b=>{b.stopPropagation(),o(a.id)},disabled:r===a.id,className:"absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold transition-colors opacity-0 group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete image",children:r===a.id?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-white"}):"×"}),e.jsx("div",{className:"absolute bottom-1 right-1 bg-green-600 text-white text-xs px-1.5 py-0.5 rounded",children:"✓"})]},a.id))})]}),X=({uploading:t,count:r,onUpload:o,onCancelAll:m})=>e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full",children:[e.jsx("button",{onClick:o,disabled:t,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm flex items-center justify-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading ",r," image(s)..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload ",r," image(s)"]})}),e.jsx("button",{onClick:m,disabled:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm",children:"Cancel All"})]}),Z=({uploading:t,onClick:r})=>e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsx("button",{type:"button",onClick:r,disabled:t,className:`w-full cursor-pointer flex flex-col items-center justify-center ${t?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"} rounded-lg p-4 transition-colors border-none bg-transparent`,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to select images (Multiple supported)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max 2MB per image • JPEG, PNG, JPG, GIF"})]})})});function te({card:t}){const[r,o]=l.useState(!1),{deliveryProofs:m,fetchProofs:a,uploadFiles:b,deleteProof:y,deletingId:C}=K(t?.id),[g,v]=l.useState(null),[c,i]=l.useState([]),[u,p]=l.useState(!1),[S,j]=l.useState({}),f=l.useRef(null),h=t?.latest_status.status,L=l.useCallback(()=>{a()},[a]),d=l.useRef({previewImages:[],uploadSuccessful:!1,timestamp:0,cancelled:!1,cancelledTimestamp:0});l.useEffect(()=>{d.current={previewImages:c,uploadSuccessful:u,timestamp:Date.now()}},[c,u]),l.useEffect(()=>{d.current.previewImages.length>0&&!d.current.uploadSuccessful&&d.current.timestamp>Date.now()-3e4&&(i(d.current.previewImages),p(!1))},[]);const U=l.useCallback(()=>{d.current.previewImages.length>0&&!d.current.uploadSuccessful&&c.length===0&&!u&&Date.now()-d.current.timestamp>1e3&&i(d.current.previewImages)},[c,u]);l.useEffect(()=>(window.addEventListener("resize",U),()=>window.removeEventListener("resize",U)),[U]),l.useEffect(()=>{h==="received_by_customer"&&L()},[h,L]);const{handleUpdateSubmission:E}=O(t?.id),F=()=>Math.random().toString(36).substring(2)+Date.now().toString(36),_=s=>{const n=s.target.files;if(!n||n.length===0)return;const{valid:x,errors:w}=J(Array.from(n));if(w.length>0){alert(w.join(`
`)),s.target.value="";return}if(x.length===0){s.target.value="";return}p(!1);const N=x.map(k=>new Promise(P=>{const I=new FileReader,W=F();I.onloadend=()=>{P({file:k,preview:I.result,id:W})},I.readAsDataURL(k)}));Promise.all(N).then(k=>{const P=[...c,...k];i(P),d.current={previewImages:P,uploadSuccessful:!1,timestamp:Date.now()}}),s.target.value=""},R=async()=>{if(!(c.length===0||!t?.id)){o(!0),j({});try{const s=c.map(x=>x.file);await b(s),p(!0),d.current={previewImages:[],uploadSuccessful:!0,timestamp:Date.now()},setTimeout(()=>{L()},500),setTimeout(()=>{i([]),j({})},100);const n=document.getElementById("delivery-proof-upload");n&&(n.value=""),f.current&&(f.current.value="")}catch(s){const n=s;console.error("Error uploading delivery proofs:",n),p(!1);const x=n?.response?.data?.message||"Failed to upload one or more delivery proofs";alert(x)}finally{o(!1),j({})}}},B=async s=>{t?.id&&(await y(s),g&&g.includes(`delivery-proof/${s}`)&&v(null))},A=s=>{const n=c.filter(x=>x.id!==s);i(n),d.current={previewImages:n,uploadSuccessful:!1,timestamp:Date.now()}},G=()=>{const s=Date.now();i([]),p(!1),j({}),d.current={previewImages:[],uploadSuccessful:!1,timestamp:s,cancelled:!0,cancelledTimestamp:s};const n=document.getElementById("delivery-proof-upload");n&&(n.value=""),f.current&&(f.current.value=""),[100,300,600,1e3,1500].forEach(w=>{setTimeout(()=>{d.current={previewImages:[],uploadSuccessful:!1,timestamp:s,cancelled:!0,cancelledTimestamp:s},i(N=>N.length>0?[]:N)},w)})},T=()=>{let s=f.current;if(s||(s=document.getElementById("delivery-proof-upload")),s)try{s.click()}catch{try{const n=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});s.dispatchEvent(n)}catch(n){console.error("Failed to trigger file input:",n)}}};return h==="data_input"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-3 sm:p-4 lg:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Current Status:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:M(h)})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Action Required"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Please confirm when you have sent your card to Grading Facility for grading."})]}),e.jsxs("button",{onClick:()=>E("delivery_to_jp"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirm Sent to Grading Facility"]})]})]}):h==="payment_request"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-3 sm:p-4 lg:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Current Status:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:M(h)})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"Payment Required"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your card grading is complete! Please proceed with payment to continue with delivery."})]}),e.jsxs("div",{className:"space-y-3",children:[t?.payment_url?e.jsxs("button",{onClick:()=>window.open(t.payment_url,"_blank"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Proceed to Payment"]}):e.jsx("div",{className:"w-full bg-gray-100 text-gray-600 px-4 py-3 rounded-lg font-medium text-sm sm:text-base text-center",children:"Payment link not available yet"}),e.jsxs("button",{onClick:()=>E("delivery_to_customer"),className:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirm Payment"]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Instructions:"}),e.jsxs("ol",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:'1. Click "Proceed to Payment" to complete your payment'}),e.jsx("li",{children:'2. After successful payment, click "Confirm Payment"'}),e.jsx("li",{children:"3. Your card will be prepared for delivery"})]})]})]})]})]}):h==="received_by_customer"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-3 sm:p-4 lg:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Current Status:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:M(h)})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-900 mb-2",children:"Proof Required"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Please upload photos as proof that you have received your graded card. You can select multiple images at once."})]}),e.jsxs("div",{className:"space-y-4",children:[!u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Delivery Proof (Multiple Images Supported)"}),e.jsx("input",{ref:f,type:"file",accept:"image/jpeg,image/png,image/jpg,image/gif",onChange:_,disabled:r,multiple:!0,className:"hidden",id:"delivery-proof-upload"}),e.jsx(Z,{uploading:r,onClick:T}),c.length>0&&!u&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{previews:c,uploading:r,uploadProgress:S,onRemove:A}),e.jsx(X,{uploading:r,count:c.length,onUpload:R,onCancelAll:G})]})]}),u&&e.jsxs("div",{className:"p-4 bg-green-100 border-2 border-green-500 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4"})}),e.jsx("span",{className:"font-medium",children:"Upload Successful!"})]}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Your delivery proof images have been uploaded successfully. You can upload more images or complete your submission."})]}),m.length>0&&e.jsx(V,{proofs:m,deletingId:C,onDelete:B,onPreview:s=>v(s)}),u&&e.jsxs("button",{onClick:()=>{p(!1)},className:"w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add More Images"]}),m.length>0&&e.jsxs("button",{onClick:()=>E("done"),className:"w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4"})}),"Complete Submission"]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Instructions:"}),e.jsxs("ol",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:'1. Click "Click to select images" to choose multiple photos at once'}),e.jsx("li",{children:"2. Review the previews and remove any unwanted images by clicking the × button"}),e.jsx("li",{children:'3. Click "Upload Images" to upload all selected photos'}),e.jsx("li",{children:'4. Click "Add More Images" to upload additional photos if needed'}),e.jsx("li",{children:'5. Click "Complete Submission" when all photos are uploaded'})]})]})]})]}),e.jsx(H,{url:g,onClose:()=>v(null)})]}):null}export{te as default};

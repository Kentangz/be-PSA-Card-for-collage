import{j as e,g as _,r as n,u as q,a as $,b as L,I as H,F as J,v as K}from"./index-CMsD3Uji.js";const O=({previews:t,uploading:i,uploadProgress:o,onRemove:m})=>t.length===0?null:e.jsxs("div",{className:"mt-3 space-y-3 border-2 border-green-500 p-4 rounded-lg bg-green-50",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h5",{className:"text-sm font-medium text-green-900",children:["Selected Images (",t.length,")"]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:t.map(r=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:r.preview,alt:`Preview ${r.file.name}`,className:"w-full h-16 sm:h-20 object-cover rounded-lg border border-gray-300 shadow-sm"}),i&&o[r.id]!==void 0&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"text-white text-xs",children:[o[r.id],"%"]})}),e.jsx("button",{onClick:()=>m(r.id),disabled:i,className:"absolute -top-1 -right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold transition-colors opacity-0 group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Remove image",children:"×"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg truncate",children:r.file.name})]},r.id))})]}),Q=({proofs:t,deletingId:i,onDelete:o,onPreview:m})=>t.length===0?null:e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:["Uploaded Proofs (",t.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:t.map(r=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:_(r.image_path),alt:`Delivery proof ${r.id}`,className:"w-full h-20 sm:h-24 object-cover rounded-lg border cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>m(_(r.image_path))}),e.jsx("button",{onClick:f=>{f.stopPropagation(),o(r.id)},disabled:i===r.id,className:"absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold transition-colors opacity-0 group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete image",children:i===r.id?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-white"}):"×"}),e.jsx("div",{className:"absolute bottom-1 right-1 bg-green-600 text-white text-xs px-1.5 py-0.5 rounded",children:"✓"})]},r.id))})]}),V=({uploading:t,count:i,onUpload:o,onCancelAll:m})=>e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full",children:[e.jsx("button",{onClick:o,disabled:t,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm flex items-center justify-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading ",i," image(s)..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload ",i," image(s)"]})}),e.jsx("button",{onClick:m,disabled:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm",children:"Cancel All"})]}),X=({uploading:t,onClick:i})=>e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsx("button",{type:"button",onClick:i,disabled:t,className:`w-full cursor-pointer flex flex-col items-center justify-center ${t?"opacity-50 cursor-not-allowed":"hover:bg-gray-50"} rounded-lg p-4 transition-colors border-none bg-transparent`,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to select images (Multiple supported)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max 2MB per image • JPEG, PNG, JPG, GIF"})]})})});function ee({card:t,onStatusUpdated:i}){const[o,m]=n.useState(!1),{deliveryProofs:r,fetchProofs:f,uploadFiles:M,deleteProof:E,deletingId:U}=q(t?.id),[k,C]=n.useState(null),[d,p]=n.useState([]),[u,g]=n.useState(!1),[D,v]=n.useState({}),h=n.useRef(null),x=t?.latest_status.status,P=n.useCallback(()=>{f()},[f]),a=n.useRef({previewImages:[],uploadSuccessful:!1,timestamp:0,cancelled:!1,cancelledTimestamp:0});n.useEffect(()=>{a.current={previewImages:d,uploadSuccessful:u,timestamp:Date.now()}},[d,u]),n.useEffect(()=>{a.current.previewImages.length>0&&!a.current.uploadSuccessful&&a.current.timestamp>Date.now()-3e4&&(p(a.current.previewImages),g(!1))},[]);const S=n.useCallback(()=>{a.current.previewImages.length>0&&!a.current.uploadSuccessful&&d.length===0&&!u&&Date.now()-a.current.timestamp>1e3&&p(a.current.previewImages)},[d,u]);n.useEffect(()=>(window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)),[S]),n.useEffect(()=>{x==="received_by_customer"&&P()},[x,P]);const{handleUpdateSubmission:I,isLoading:b}=$(t?.id,{onSuccess:s=>{i?.(s)}}),B=()=>Math.random().toString(36).substring(2)+Date.now().toString(36),R=s=>{const l=s.target.files;if(!l||l.length===0)return;const{valid:c,errors:j}=K(Array.from(l));if(j.length>0){alert(j.join(`
`)),s.target.value="";return}if(c.length===0){s.target.value="";return}g(!1);const y=c.map(w=>new Promise(N=>{const F=new FileReader,Y=B();F.onloadend=()=>{N({file:w,preview:F.result,id:Y})},F.readAsDataURL(w)}));Promise.all(y).then(w=>{const N=[...d,...w];p(N),a.current={previewImages:N,uploadSuccessful:!1,timestamp:Date.now()}}),s.target.value=""},A=async()=>{if(!(d.length===0||!t?.id)){m(!0),v({});try{const s=d.map(c=>c.file);await M(s),g(!0),a.current={previewImages:[],uploadSuccessful:!0,timestamp:Date.now()},setTimeout(()=>{P()},500),setTimeout(()=>{p([]),v({})},100);const l=document.getElementById("delivery-proof-upload");l&&(l.value=""),h.current&&(h.current.value="")}catch(s){const l=s;console.error("Error uploading delivery proofs:",l),g(!1);const c=l?.response?.data?.message||"Failed to upload one or more delivery proofs";alert(c)}finally{m(!1),v({})}}},G=async s=>{t?.id&&(await E(s),k&&k.includes(`delivery-proof/${s}`)&&C(null))},T=s=>{const l=d.filter(c=>c.id!==s);p(l),a.current={previewImages:l,uploadSuccessful:!1,timestamp:Date.now()}},W=()=>{const s=Date.now();p([]),g(!1),v({}),a.current={previewImages:[],uploadSuccessful:!1,timestamp:s,cancelled:!0,cancelledTimestamp:s};const l=document.getElementById("delivery-proof-upload");l&&(l.value=""),h.current&&(h.current.value=""),[100,300,600,1e3,1500].forEach(j=>{setTimeout(()=>{a.current={previewImages:[],uploadSuccessful:!1,timestamp:s,cancelled:!0,cancelledTimestamp:s},p(y=>y.length>0?[]:y)},j)})},z=()=>{let s=h.current;if(s||(s=document.getElementById("delivery-proof-upload")),s)try{s.click()}catch{try{const l=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});s.dispatchEvent(l)}catch(l){console.error("Failed to trigger file input:",l)}}};return x==="data_input"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-3 sm:p-4 lg:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Current Status:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:L(x)})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Action Required"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Please confirm when you have sent your card to Grading Facility for grading."})]}),e.jsx("button",{onClick:()=>I("delivery_to_jp"),disabled:b("delivery_to_jp"),className:"w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:b("delivery_to_jp")?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Confirming..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirm Sent to Grading Facility"]})})]})]}):x==="payment_request"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-3 sm:p-4 lg:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Current Status:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:L(x)})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"Payment Required"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your card grading is complete! Please proceed with payment to continue with delivery."})]}),e.jsxs("div",{className:"space-y-3",children:[t?.payment_url?e.jsxs("button",{onClick:()=>window.open(t.payment_url,"_blank"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Proceed to Payment"]}):e.jsx("div",{className:"w-full bg-gray-100 text-gray-600 px-4 py-3 rounded-lg font-medium text-sm sm:text-base text-center",children:"Payment link not available yet"}),e.jsx("button",{onClick:()=>I("delivery_to_customer"),disabled:b("delivery_to_customer"),className:"w-full bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:b("delivery_to_customer")?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Confirming..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirm Payment"]})}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Instructions:"}),e.jsxs("ol",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:'1. Click "Proceed to Payment" to complete your payment'}),e.jsx("li",{children:'2. After successful payment, click "Confirm Payment"'}),e.jsx("li",{children:"3. Your card will be prepared for delivery"})]})]})]})]})]}):x==="received_by_customer"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-3 sm:p-4 lg:p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Current Status:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:L(x)})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-900 mb-2",children:"Proof Required"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Please upload photos as proof that you have received your graded card. You can select multiple images at once."})]}),e.jsxs("div",{className:"space-y-4",children:[!u&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Delivery Proof (Multiple Images Supported)"}),e.jsx("input",{ref:h,type:"file",accept:"image/jpeg,image/png,image/jpg,image/gif",onChange:R,disabled:o,multiple:!0,className:"hidden",id:"delivery-proof-upload"}),e.jsx(X,{uploading:o,onClick:z}),d.length>0&&!u&&e.jsxs(e.Fragment,{children:[e.jsx(O,{previews:d,uploading:o,uploadProgress:D,onRemove:T}),e.jsx(V,{uploading:o,count:d.length,onUpload:A,onCancelAll:W})]})]}),u&&e.jsxs("div",{className:"p-4 bg-green-100 border-2 border-green-500 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4"})}),e.jsx("span",{className:"font-medium",children:"Upload Successful!"})]}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Your delivery proof images have been uploaded successfully. You can upload more images or complete your submission."})]}),r.length>0&&e.jsx(Q,{proofs:r,deletingId:U,onDelete:G,onPreview:s=>C(s)}),u&&e.jsxs("button",{onClick:()=>{g(!1)},className:"w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add More Images"]}),r.length>0&&e.jsx("button",{onClick:()=>I("done"),disabled:b("done"),className:"w-full bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base flex items-center justify-center gap-2",children:b("done")?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4"})}),"Complete Submission"]})}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Instructions:"}),e.jsxs("ol",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:'1. Click "Click to select images" to choose multiple photos at once'}),e.jsx("li",{children:"2. Review the previews and remove any unwanted images by clicking the × button"}),e.jsx("li",{children:'3. Click "Upload Images" to upload all selected photos'}),e.jsx("li",{children:'4. Click "Add More Images" to upload additional photos if needed'}),e.jsx("li",{children:'5. Click "Complete Submission" when all photos are uploaded'})]})]})]})]}),e.jsx(H,{url:k,onClose:()=>C(null)}),e.jsx(J,{position:"top-center"})]}):null}export{ee as default};
